<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multi-Modal Sentiment Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#edf2f4] text-[#27293c]">

<header class="bg-[#2b2d42] text-[#edf2f4] p-4 shadow-md">
    <h1 class="text-2xl font-bold">Multi-Modal Sentiment Dashboard</h1>
    <p class="text-sm">Upload images to see OCR + Sentiment Analysis</p>
</header>

<main class="max-w-7xl mx-auto p-6">

    <!-- Upload Section -->
    <section class="mb-6 bg-[#f7fafa] p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">Upload Images</h2>
        <input type="file" id="fileInput" multiple class="mb-4" accept=".jpg,.jpeg,.png">
        <button id="uploadBtn" class="bg-[#696e9d] hover:bg-[#9b9ebe] text-[#edf2f4] px-4 py-2 rounded">Predict</button>
        <p id="status" class="mt-2 text-[#27293c]"></p>
    </section>

    <!-- Charts Section -->
    <section id="chartsSection" class="hidden mb-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-[#f7fafa] p-4 rounded shadow">
            <h2 class="text-lg font-semibold mb-2">Sentiment Distribution</h2>
            <canvas id="sentimentChart"></canvas>
        </div>
        <div class="bg-[#f7fafa] p-4 rounded shadow">
            <h2 class="text-lg font-semibold mb-2">Confidence per Image (%)</h2>
            <canvas id="accuracyChart"></canvas>
        </div>
    </section>

    <!-- Table Section -->
    <section id="tableSection" class="hidden bg-[#f7fafa] p-6 rounded shadow">
        <h2 class="text-xl font-semibold mb-4">Prediction Results</h2>
        <div class="overflow-x-auto">
            <table class="w-full table-auto border-collapse">
                <thead>
                    <tr class="bg-[#d2d6df]">
                        <th class="px-4 py-2 text-left">Preview</th>
                        <th class="px-4 py-2 text-left">Filename</th>
                        <th class="px-4 py-2 text-left">Label</th>
                        <th class="px-4 py-2 text-left">Confidence</th>
                        <th class="px-4 py-2 text-left">OCR Text</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </section>

</main>

<script>
const fileInput = document.getElementById("fileInput");
const uploadBtn = document.getElementById("uploadBtn");
const status = document.getElementById("status");
const tableBody = document.getElementById("tableBody");
const chartsSection = document.getElementById("chartsSection");
const tableSection = document.getElementById("tableSection");

let sentimentChart, accuracyChart;

// Distinct color palette for bars (different for each image)
const distinctColors = [
    '#27293c','#2b2d42','#696e9d','#9b9ebe','#8d99ae','#d90429','#ef233c','#a30000','#4a4d72','#ced0df'
];

const sentimentColors = {
    Positive: '#4a4d72',
    Neutral: '#8d99ae',
    Negative: '#d90429'
};

uploadBtn.addEventListener("click", async () => {
    const files = fileInput.files;
    if (!files.length) {
        alert("Please select files to upload");
        return;
    }

    status.textContent = "Uploading...";
    const formData = new FormData();
    for (let file of files) formData.append("files", file);

    // Convert files to base64 for preview
    const filePreviews = await Promise.all([...files].map(file => new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = e => resolve(e.target.result);
        reader.readAsDataURL(file);
    })));

    try {
        const response = await fetch("http://127.0.0.1:8000/predict", {
            method: "POST",
            body: formData
        });
        if (!response.ok) throw new Error("Upload failed");
        const data = await response.json();
        status.textContent = "Prediction complete!";

        chartsSection.classList.remove("hidden");
        tableSection.classList.remove("hidden");

        tableBody.innerHTML = "";
        let positive = 0, neutral = 0, negative = 0;

        const imageLabels = [];
        const imageConfidences = [];
        const imageColors = [];

        data.predictions.forEach((pred, idx) => {
            const row = document.createElement("tr");

            const imgPreview = document.createElement("img");
            imgPreview.src = filePreviews[idx];
            imgPreview.alt = pred.filename;
            imgPreview.className = "h-16 w-16 object-cover rounded";

            row.innerHTML = `
                <td class="px-4 py-2 text-sm"></td>
                <td class="px-4 py-2 text-sm">${pred.filename}</td>
                <td class="px-4 py-2 text-sm">${pred.predicted_label_text}</td>
                <td class="px-4 py-2 text-sm">${(pred.confidence_score*100).toFixed(2)}%</td>
                <td class="px-4 py-2 text-sm">${pred.ocr_text}</td>
            `;
            row.cells[0].appendChild(imgPreview);
            tableBody.appendChild(row);

            imageLabels.push(pred.filename);
            imageConfidences.push((pred.confidence_score*100).toFixed(2));
            imageColors.push(distinctColors[idx % distinctColors.length]);

            if(pred.predicted_label_text === "Positive") positive++;
            else if(pred.predicted_label_text === "Neutral") neutral++;
            else negative++;
        });

        // Sentiment Pie Chart
        const ctx1 = document.getElementById('sentimentChart').getContext('2d');
        if(sentimentChart) sentimentChart.destroy();
        sentimentChart = new Chart(ctx1, {
            type: 'pie',
            data: {
                labels: ['Positive', 'Neutral', 'Negative'],
                datasets: [{
                    data: [positive, neutral, negative],
                    backgroundColor: [sentimentColors.Positive, sentimentColors.Neutral, sentimentColors.Negative]
                }]
            },
            options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
        });

        // Confidence Bar Chart per Image
        const ctx2 = document.getElementById('accuracyChart').getContext('2d');
        if(accuracyChart) accuracyChart.destroy();
        accuracyChart = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: imageLabels,
                datasets: [{
                    label: 'Confidence (%)',
                    data: imageConfidences,
                    backgroundColor: imageColors
                }]
            },
            options: {
                responsive: true,
                scales: { y: { beginAtZero: true, max: 100 } }
            }
        });

    } catch (err) {
        console.error(err);
        status.textContent = "Error during prediction. Check console.";
    }
});
</script>

</body>
</html>
<!-- python -m http.server 5500 -->